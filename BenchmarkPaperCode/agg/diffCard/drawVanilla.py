import matplotlib.pyplot as plt
import numpy as np

# Define data for Vanilla Spark
vanilla_data = {
    "Query 1: select id1, sum(v1)": [1.3968335849999998, 0.34614896433333336, 0.37549477266666664, 0.46328162, 0.9123769896666666, 1.3378149803333332, 1.9523405909999998],
    "Query 2: select id1, id2, sum(v1)": [0.673610633, 0.6660622326666666, 1.5122598726666665, 2.1317975013333332, 2.3534975276666668, 2.155066433, 2.5809471299999998],
    "Query 3: select id3, sum(v1), mean(v3)": [1.9036237070000002, 0.9562760303333334, 0.5310241426666666, 0.4044552153333334, 0.3451713063333333, 0.32100786, 0.5482946926666666],
    "Query 4: select id4, mean(v1), mean(v2), mean(v3)": [0.47457244633333334, 0.30176702066666666, 0.36482544533333333, 0.3636948013333334, 0.6875622183333333, 1.3738595156666669, 1.8272650133333332],
    "Query 5: select id6, sum(v1), sum(v2), sum(v3)": [1.6668284403333333, 0.6147155733333333, 0.37559333766666664, 0.33401989700000007, 0.28785417133333335, 0.25880562100000004, 0.5784325583333333],
    "Query 6: select id3, max(v1) - min(v2)": [1.7196566566666667, 0.9887951953333335, 0.4918967486666667, 0.377232867, 0.31083345933333334, 0.30269683166666667, 0.5361904413333334],
    "Query 7: select id6, largest2_v3": [1.9800747066666666, 1.5593750560000001, 1.3885029686666668, 1.644205147, 1.4439171800000004, 2.5957614566666667, 19.65326139],
    "Query 8: select id2, id4, pow(corr(v1, v2), 2)": [0.5183740743333334, 0.6120837183333333, 1.7277535773333332, 2.0933751566666667, 2.290184427, 2.0815177080000002, 2.4514188706666666],
    "Query 9: select id1, id2, id3, id4, id5, id6, sum(v3), count(*)": [3.3983859383333335, 3.3959304963333334, 3.078593271666667, 3.1860619366666665, 3.4761816983333333, 3.299557085, 3.841492737333333]
}

# Define data for ClickHouse, DataFusion, and Velox
# Replace placeholders with the respective data
clickhouse_data = {
    "Query 1: select id1, sum(v1)": [0.949013711, 0.177479050, 0.165087623, 0.200920726, 0.286103035, 0.530410756, 0.789679390],
    "Query 2: select id1, id2, sum(v1)": [0.349309529, 0.325118714, 0.963030457, 1.467972416, 1.485619467, 1.515688385, 1.507269822],
    "Query 3: select id3, sum(v1), mean(v3)": [0.937097089, 0.348785692, 0.221642265, 0.215945033, 0.182090205, 0.176910057, 0.185342925],
    "Query 4: select id4, mean(v1), mean(v2), mean(v3)": [0.259938429, 0.213406420, 0.204637815, 0.216477570, 0.319201435, 0.629580832, 0.899622819],
    "Query 5: select id6, sum(v1), sum(v2), sum(v3)": [0.804610153, 0.347387106, 0.203727532, 0.162399293, 0.155593209, 0.152533481, 0.142425018],
    "Query 6: select id3, max(v1) - min(v2)": [0.786539660, 0.355628153, 0.244864627, 0.206589262, 0.187015943, 0.167613568, 0.166410555],
    "Query 7: select id6, largest2_v3": [0.659639896, 0.523523004, 0.476865363, 0.486380700, 0.439922257, 0.643509366, 5.803693388],
    "Query 8: select id2, id4, pow(corr(v1, v2), 2)": [0.268076620, 0.328253607, 1.140306662, 1.623735940, 1.665385582, 1.702474399, 1.636774198],
    "Query 9: select id1, id2, id3, id4, id5, id6, sum(v3), count(*)": [2.355915623, 2.273604895, 2.246466861, 2.268001547, 2.351709179, 2.410696723, 2.367912871],
}

datafusion_data = {
    "Query 1: select id1, sum(v1)": [1.849232893, 0.630145477, 0.570019303, 0.647141574, 1.17075013, 1.208127659, 1.657298272],
    "Query 2: select id1, id2, sum(v1)": [0.933483298, 0.684510113, 1.222822724, 1.791937739, 1.958843717, 1.914021209, 1.972140743],
    "Query 3: select id3, sum(v1), mean(v3)": [2.122685896, 1.637109084, 0.684728128, 0.690661965, 0.638771511, 0.660622696, 0.706740484],
    "Query 4: select id4, mean(v1), mean(v2), mean(v3)": [0.841785622, 0.74945197, 0.64552435, 0.712239552, 1.603820113, 1.692070474, 1.985134504],
    "Query 5: select id6, sum(v1), sum(v2), sum(v3)": [1.773040304, 1.484121255, 0.715145352, 0.66013254, 0.666851909, 0.661266679, 0.748073838],
    "Query 6: select id3, max(v1) - min(v2)": [1.699134345, 1.261109323, 0.741201347, 0.60224708, 0.60268627, 0.616196004, 0.701538429],
    "Query 8: select id2, id4, pow(corr(v1, v2), 2)": [0.95620923, 0.791158933, 1.980246648, 2.197057711, 2.167584409, 2.043032274, 2.416360088],
    "Query 9: select id1, id2, id3, id4, id5, id6, sum(v3), count(*)": [2.908819745, 2.740806772, 2.557607332, 2.550062098, 2.709077793, 2.606701262, 2.710046178],
}

velox_data = {
    "Query 1: select id1, sum(v1)": [0.95057654, 0.173260322, 0.159366391, 0.227851092, 0.394046207, 0.465918769, 0.675852238],
    "Query 2: select id1, id2, sum(v1)": [0.246895805, 0.225427063, 0.466533084, 0.818492193, 1.078144471, 0.993754512, 1.123539013],
    "Query 3: select id3, sum(v1), mean(v3)": [0.8633678, 0.458502987, 0.285366543, 0.199827864, 0.186813652, 0.15500596, 0.155732804],
    "Query 4: select id4, mean(v1), mean(v2), mean(v3)": [0.240747814, 0.201522989, 0.193308207, 0.198317983, 0.317679362, 0.63975416, 0.675368543],
    "Query 5: select id6, sum(v1), sum(v2), sum(v3)": [0.611628129, 0.282062582, 0.209276613, 0.17295776, 0.165078521, 0.148058262, 0.151200523],
    "Query 6: select id3, max(v1) - min(v2)": [0.634576546, 0.417463425, 0.263628781, 0.179541454, 0.163950275, 0.136981096, 0.128670165],
    "Query 7: select id6, largest2_v3": [0.699350815, 0.506132808, 0.53711962, 0.502206013, 0.564643176, 1.147615506, 4.673482733],
    "Query 8: select id2, id4, pow(corr(v1, v2), 2)": [0.283256751, 0.261666745, 0.609818657, 0.897848856, 1.061150559, 1.097061838, 1.114085643],
    "Query 9: select id1, id2, id3, id4, id5, id6, sum(v3), count(*)": [1.471521821, 1.449848568, 1.179753412, 1.205302332, 1.277940756, 1.335359189, 1.393970442],
}

cardinalities = ["df1", "df2", "df3", "df4", "df5", "df6", "df7"]

# Initialize subplots
queries = vanilla_data.keys()
fig, axes = plt.subplots(len(queries), 1, figsize=(10, 5 * len(queries)))

# Plot data for each query
for i, query in enumerate(queries):
    ax = axes[i] if len(queries) > 1 else axes
    ax.plot(cardinalities, vanilla_data[query], label="Vanilla", marker='o')
    ax.plot(cardinalities, clickhouse_data[query], label="ClickHouse", marker='s')
    ax.plot(cardinalities, datafusion_data[query], label="DataFusion", marker='^')
    ax.plot(cardinalities, velox_data[query], label="Velox", marker='d')
    ax.set_title(query)
    ax.set_xlabel("Cardinality")
    ax.set_ylabel("Execution Time (s)")
    ax.legend()
    ax.grid(True)

# Adjust layout and display the plot
plt.tight_layout()
plt.show()
plt.savefig("./diffCard.png")